<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Iframe Test App</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }
        .container {
            background: rgba(255, 255, 255, 0.1);
            padding: 30px;
            border-radius: 15px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            max-width: 600px;
            width: 100%;
        }
        h1 {
            text-align: center;
            color: #fff;
            margin-bottom: 20px;
        }
        .user-info {
            background: rgba(255, 255, 255, 0.1);
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
        }
        .param {
            margin: 10px 0;
            padding: 10px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 5px;
        }
        .param strong {
            color: #4CAF50;
        }
        .success {
            color: #4CAF50;
            font-weight: bold;
        }
        .error {
            color: #ff6b6b;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üéØ Iframe Integration Test</h1>
        
        <div class="user-info">
            <h3>User Context Information:</h3>
            <div id="userInfo">Loading...</div>
        </div>

        <div class="user-info">
            <h3>All URL Parameters:</h3>
            <div id="allParams">Loading...</div>
        </div>

        <div class="user-info">
            <h3>Integration Status:</h3>
            <div id="status">Checking...</div>
        </div>

        <div class="user-info" id="sdkSection" style="display: none;">
            <h3>SDK Test Results:</h3>
            <div id="sdkStatus">Testing SDK...</div>
            <button onclick="testSDK()" style="margin-top: 10px; padding: 10px 20px; background: #4CAF50; color: white; border: none; border-radius: 5px; cursor: pointer;">Test SDK Connection</button>
        </div>
    </div>

    <!-- Load VentureVerse SDK Secure -->
    <script src="../src/ventureverse-sdk-secure.js"></script>
    
    <script>
        function getURLParameters() {
            const urlParams = new URLSearchParams(window.location.search);
            const params = {};
            for (const [key, value] of urlParams.entries()) {
                params[key] = value;
            }
            return params;
        }

        function displayUserInfo() {
            const params = getURLParameters();
            const userInfoDiv = document.getElementById('userInfo');
            const allParamsDiv = document.getElementById('allParams');
            const statusDiv = document.getElementById('status');

            // Display user-specific info
            let userInfoHTML = '';
            if (params.user_id) {
                userInfoHTML += `<div class="param"><strong>User ID:</strong> ${params.user_id}</div>`;
            }
            if (params.user_email) {
                userInfoHTML += `<div class="param"><strong>Email:</strong> ${params.user_email}</div>`;
            }
            if (params.user_name) {
                userInfoHTML += `<div class="param"><strong>Name:</strong> ${params.user_name}</div>`;
            }

            if (userInfoHTML === '') {
                userInfoHTML = '<div class="error">No user context found</div>';
            }

            userInfoDiv.innerHTML = userInfoHTML;

            // Display all parameters
            let allParamsHTML = '';
            for (const [key, value] of Object.entries(params)) {
                allParamsHTML += `<div class="param"><strong>${key}:</strong> ${value}</div>`;
            }

            if (allParamsHTML === '') {
                allParamsHTML = '<div class="error">No URL parameters found</div>';
            }

            allParamsDiv.innerHTML = allParamsHTML;

            // Display status
            let statusHTML = '';
            if (params.user_id && params.user_email) {
                statusHTML = '<div class="success">‚úÖ Iframe integration working! User context successfully passed.</div>';
            } else if (Object.keys(params).length > 0) {
                statusHTML = '<div class="error">‚ö†Ô∏è Partial integration - some parameters missing</div>';
            } else {
                statusHTML = '<div class="error">‚ùå No integration detected - no parameters passed</div>';
            }

            statusDiv.innerHTML = statusHTML;
        }

        // SDK Testing
        let sdk = null;

        async function testSDK() {
            const sdkStatusDiv = document.getElementById('sdkStatus');
            const params = getURLParameters();
            
            try {
                sdkStatusDiv.innerHTML = '<div style="color: #ffc107;">üîÑ Initializing SDK...</div>';
                
                // Get API credentials from URL parameters or use demo values
                const apiKey = params.api_key || 'vv_demo_key_12345';
                const apiSecret = params.api_secret || 'vv_secret_demo_secret_67890';
                
                sdk = new VentureVerseSDKSecure({
                    apiKey: apiKey,
                    apiSecret: apiSecret,
                    debug: true,
                    enableEncryption: true
                });

                await sdk.initialize();
                await sdk.loadInitialData();
                
                sdkStatusDiv.innerHTML = '<div class="success">‚úÖ SDK initialized successfully!</div>';
                
                // Try to get user profile
                try {
                    const userProfile = await sdk.getUserProfile();
                    sdkStatusDiv.innerHTML += `<div style="margin-top: 10px;"><strong>User Profile:</strong> ${userProfile.name || 'Demo User'} (${userProfile.email || 'demo@example.com'})</div>`;
                } catch (error) {
                    sdkStatusDiv.innerHTML += `<div style="color: #ffc107; margin-top: 10px;">‚ö†Ô∏è User profile: Using demo data (${error.message})</div>`;
                }
                
                // Try to get credits
                try {
                    const credits = await sdk.getCredits();
                    sdkStatusDiv.innerHTML += `<div style="margin-top: 10px;"><strong>Credits:</strong> ${credits}</div>`;
                } catch (error) {
                    sdkStatusDiv.innerHTML += `<div style="color: #ffc107; margin-top: 10px;">‚ö†Ô∏è Credits: Using demo data (${error.message})</div>`;
                }
                
            } catch (error) {
                console.error('SDK Test Error:', error);
                sdkStatusDiv.innerHTML = `<div class="error">‚ùå SDK test failed: ${error.message}</div>`;
            }
        }

        // Display info when page loads
        displayUserInfo();

        // Show SDK section after basic info is loaded
        setTimeout(() => {
            document.getElementById('sdkSection').style.display = 'block';
        }, 500);

        // Debug current URL
        console.log('Current URL:', window.location.href);
        console.log('URL params:', getURLParameters());

        // Also display parent window info if available
        try {
            if (window.parent !== window) {
                console.log('Running inside iframe');
                document.title = 'Iframe Test App (Inside Iframe)';
            } else {
                console.log('Running standalone');
            }
        } catch (e) {
            console.log('Cross-origin iframe restrictions');
        }
    </script>
</body>
</html>