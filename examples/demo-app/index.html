<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VentureVerse Demo App - Task Manager</title>
    <meta http-equiv="Content-Security-Policy" content="frame-ancestors 'self' https://ventureverse.com https://*.ventureverse.com;">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: #333;
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 900px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
        }
        
        .header {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 2px solid #f0f0f0;
        }
        
        .user-info {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            border-radius: 15px;
            margin-bottom: 30px;
        }
        
        .credits-section {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            border-left: 4px solid #28a745;
        }
        
        .task-section {
            margin-top: 30px;
        }
        
        .task-input {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }
        
        .task-input input {
            flex: 1;
            padding: 12px;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            font-size: 16px;
        }
        
        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 600;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }
        
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(102, 126, 234, 0.3);
        }
        
        .btn-success {
            background: #28a745;
            color: white;
        }
        
        .btn-danger {
            background: #dc3545;
            color: white;
        }
        
        .btn-warning {
            background: #ffc107;
            color: #333;
        }
        
        .task-item {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-left: 4px solid #667eea;
        }
        
        .task-item.completed {
            background: #d4edda;
            border-left-color: #28a745;
            text-decoration: line-through;
            opacity: 0.7;
        }
        
        .task-actions {
            display: flex;
            gap: 5px;
        }
        
        .status {
            padding: 15px;
            border-radius: 10px;
            margin: 15px 0;
            font-weight: 500;
        }
        
        .status.loading {
            background: #fff3cd;
            border-left: 4px solid #ffc107;
            color: #856404;
        }
        
        .status.success {
            background: #d4edda;
            border-left: 4px solid #28a745;
            color: #155724;
        }
        
        .status.error {
            background: #f8d7da;
            border-left: 4px solid #dc3545;
            color: #721c24;
        }
        
        .status.info {
            background: #d1ecf1;
            border-left: 4px solid #17a2b8;
            color: #0c5460;
        }
        
        .premium-feature {
            background: linear-gradient(135deg, #ffeaa7 0%, #fab1a0 100%);
            padding: 20px;
            border-radius: 15px;
            margin: 20px 0;
            text-align: center;
        }
        
        .feature-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-top: 30px;
        }
        
        .feature-card {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 15px;
            text-align: center;
            border: 2px solid #e9ecef;
            transition: all 0.3s ease;
        }
        
        .feature-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 30px rgba(0,0,0,0.1);
            border-color: #667eea;
        }
        
        .hidden {
            display: none;
        }
        
        @media (max-width: 768px) {
            .container {
                padding: 20px;
                margin: 10px;
            }
            
            .task-input {
                flex-direction: column;
            }
            
            .task-item {
                flex-direction: column;
                align-items: flex-start;
                gap: 10px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üöÄ VentureVerse Task Manager</h1>
            <p>A complete demo app showcasing VentureVerse SDK integration</p>
        </div>

        <!-- Status Messages -->
        <div id="status-container"></div>

        <!-- User Information Section -->
        <div id="user-section" class="hidden">
            <div class="user-info">
                <h2>üë§ Welcome, <span id="user-name">Loading...</span>!</h2>
                <p>üìß <span id="user-email">Loading...</span></p>
                <p>üéØ Tier: <span id="user-tier">Loading...</span></p>
            </div>

            <div class="credits-section">
                <h3>üí≥ Credit Balance</h3>
                <p>Available Credits: <strong><span id="credit-balance">0</span></strong></p>
                <p style="font-size: 14px; color: #666; margin-top: 10px;">
                    Each task action costs 0.1 credits. Premium features cost more.
                </p>
            </div>
        </div>

        <!-- Task Management Section -->
        <div id="task-section" class="hidden">
            <div class="task-section">
                <h2>üìù Task Manager</h2>
                <div class="task-input">
                    <input type="text" id="task-input" placeholder="Enter a new task..." maxlength="100">
                    <button class="btn btn-primary" onclick="addTask()">Add Task (0.1 credits)</button>
                </div>
                
                <div id="task-list"></div>
            </div>

            <!-- Premium Features -->
            <div class="premium-feature">
                <h3>‚≠ê Premium Features</h3>
                <p>Unlock advanced task management capabilities!</p>
                <button class="btn btn-warning" onclick="generateAITask()">
                    ü§ñ Generate AI Task (1.0 credits)
                </button>
                <button class="btn btn-warning" onclick="bulkCompleteAI()">
                    ‚ú® AI Bulk Complete (2.0 credits)
                </button>
            </div>

            <!-- Feature Showcase -->
            <div class="feature-grid">
                <div class="feature-card">
                    <h4>üîê Secure Authentication</h4>
                    <p>Seamless integration with VentureVerse user system</p>
                </div>
                
                <div class="feature-card">
                    <h4>üí≥ Credit Integration</h4>
                    <p>Real-time credit balance and secure deductions</p>
                </div>
                
                <div class="feature-card">
                    <h4>üì± Responsive Design</h4>
                    <p>Works perfectly in VentureVerse iframe and standalone</p>
                </div>
                
                <div class="feature-card">
                    <h4>‚ö° Real-time Updates</h4>
                    <p>Live data synchronization with the platform</p>
                </div>
            </div>
        </div>

        <!-- SDK Actions -->
        <div id="sdk-actions" class="hidden" style="margin-top: 30px; padding: 20px; background: #f8f9fa; border-radius: 15px;">
            <h3>üîß SDK Testing Tools</h3>
            <div style="display: flex; gap: 10px; flex-wrap: wrap; margin-top: 15px;">
                <button class="btn btn-success" onclick="refreshUserData()">üîÑ Refresh User Data</button>
                <button class="btn btn-success" onclick="testCreditCheck()">üí∞ Test Credit Check</button>
                <button class="btn btn-danger" onclick="simulateError()">‚ö†Ô∏è Simulate Error</button>
            </div>
        </div>
    </div>

    <!-- VentureVerse SDK Secure -->
    <script src="../../src/ventureverse-sdk-secure.js"></script>

    <script>
        // Demo App State
        let tasks = [];
        let userProfile = null;
        let sdk = null;

        // Initialize the app
        async function initializeApp() {
            try {
                showStatus('Loading VentureVerse Demo App...', 'loading');

                // Replace with your actual API credentials
                const apiKey = getApiKeyFromUrl() || 'vv_demo_key_12345';
                const apiSecret = getApiSecretFromUrl() || 'vv_secret_demo_secret_67890';
                
                sdk = new VentureVerseSDKSecure({
                    apiKey: apiKey,
                    apiSecret: apiSecret,
                    debug: true,
                    enableEncryption: true
                });

                await sdk.initialize();
                await sdk.loadInitialData();
                showStatus('SDK initialized successfully!', 'success');

                // Load user data
                await loadUserData();
                
                // Show the main app interface
                document.getElementById('user-section').classList.remove('hidden');
                document.getElementById('task-section').classList.remove('hidden');
                document.getElementById('sdk-actions').classList.remove('hidden');

                showStatus('Welcome to VentureVerse Task Manager! Start adding tasks below.', 'info');

            } catch (error) {
                console.error('Failed to initialize app:', error);
                showStatus(`Failed to initialize: ${error.message}`, 'error');
                
                // Show demo mode for testing
                showDemoMode();
            }
        }

        // Load user profile and credits
        async function loadUserData() {
            try {
                userProfile = await sdk.getUserProfile();
                
                document.getElementById('user-name').textContent = userProfile.name || 'Demo User';
                document.getElementById('user-email').textContent = userProfile.email || 'demo@example.com';
                document.getElementById('user-tier').textContent = userProfile.tier?.name || 'Free';
                
                const credits = await sdk.getCredits();
                document.getElementById('credit-balance').textContent = credits.toFixed(1);
                
            } catch (error) {
                console.error('Failed to load user data:', error);
                // Use demo data
                document.getElementById('user-name').textContent = 'Demo User';
                document.getElementById('user-email').textContent = 'demo@example.com';
                document.getElementById('user-tier').textContent = 'Free';
                document.getElementById('credit-balance').textContent = '10.0';
            }
        }

        // Add a new task
        async function addTask() {
            const input = document.getElementById('task-input');
            const taskText = input.value.trim();
            
            if (!taskText) {
                showStatus('Please enter a task!', 'error');
                return;
            }

            try {
                // Check if user has enough credits
                if (sdk && !(await sdk.hasCredits(0.1))) {
                    showStatus('Insufficient credits! You need 0.1 credits to add a task.', 'error');
                    return;
                }

                // Deduct credits
                if (sdk) {
                    await sdk.deductCredits(0.1, 'Added new task');
                    await updateCreditDisplay();
                }

                // Add task to list
                const task = {
                    id: Date.now(),
                    text: taskText,
                    completed: false,
                    createdAt: new Date().toLocaleString()
                };

                tasks.push(task);
                input.value = '';
                renderTasks();
                
                showStatus(`Task "${taskText}" added successfully!`, 'success');

            } catch (error) {
                console.error('Failed to add task:', error);
                showStatus(`Failed to add task: ${error.message}`, 'error');
            }
        }

        // Complete a task
        async function completeTask(taskId) {
            try {
                if (sdk && !(await sdk.hasCredits(0.1))) {
                    showStatus('Insufficient credits! You need 0.1 credits to complete a task.', 'error');
                    return;
                }

                if (sdk) {
                    await sdk.deductCredits(0.1, 'Completed task');
                    await updateCreditDisplay();
                }

                const task = tasks.find(t => t.id === taskId);
                if (task) {
                    task.completed = true;
                    renderTasks();
                    showStatus(`Task "${task.text}" completed!`, 'success');
                }

            } catch (error) {
                console.error('Failed to complete task:', error);
                showStatus(`Failed to complete task: ${error.message}`, 'error');
            }
        }

        // Delete a task
        async function deleteTask(taskId) {
            try {
                if (sdk && !(await sdk.hasCredits(0.1))) {
                    showStatus('Insufficient credits! You need 0.1 credits to delete a task.', 'error');
                    return;
                }

                if (sdk) {
                    await sdk.deductCredits(0.1, 'Deleted task');
                    await updateCreditDisplay();
                }

                tasks = tasks.filter(t => t.id !== taskId);
                renderTasks();
                showStatus('Task deleted successfully!', 'success');

            } catch (error) {
                console.error('Failed to delete task:', error);
                showStatus(`Failed to delete task: ${error.message}`, 'error');
            }
        }

        // Generate AI task (premium feature)
        async function generateAITask() {
            try {
                if (sdk && !(await sdk.hasCredits(1.0))) {
                    showStatus('Insufficient credits! You need 1.0 credits for AI features.', 'error');
                    return;
                }

                if (sdk) {
                    await sdk.deductCredits(1.0, 'AI task generation');
                    await updateCreditDisplay();
                }

                const aiTasks = [
                    "Review and update project documentation",
                    "Optimize database queries for better performance",
                    "Implement error handling for user inputs",
                    "Create unit tests for critical functions",
                    "Refactor legacy code for maintainability",
                    "Set up automated deployment pipeline",
                    "Conduct security audit of the application",
                    "Improve user interface accessibility"
                ];

                const randomTask = aiTasks[Math.floor(Math.random() * aiTasks.length)];
                
                const task = {
                    id: Date.now(),
                    text: `ü§ñ ${randomTask}`,
                    completed: false,
                    createdAt: new Date().toLocaleString()
                };

                tasks.push(task);
                renderTasks();
                showStatus('AI-generated task added!', 'success');

            } catch (error) {
                console.error('Failed to generate AI task:', error);
                showStatus(`Failed to generate AI task: ${error.message}`, 'error');
            }
        }

        // Bulk complete with AI (premium feature)
        async function bulkCompleteAI() {
            try {
                if (sdk && !(await sdk.hasCredits(2.0))) {
                    showStatus('Insufficient credits! You need 2.0 credits for AI bulk operations.', 'error');
                    return;
                }

                const incompleteTasks = tasks.filter(t => !t.completed);
                if (incompleteTasks.length === 0) {
                    showStatus('No incomplete tasks to process!', 'info');
                    return;
                }

                if (sdk) {
                    await sdk.deductCredits(2.0, 'AI bulk task completion');
                    await updateCreditDisplay();
                }

                // Simulate AI processing
                showStatus('AI is analyzing and completing tasks...', 'loading');
                
                setTimeout(() => {
                    incompleteTasks.forEach(task => {
                        if (Math.random() > 0.3) { // 70% chance of completion
                            task.completed = true;
                        }
                    });
                    
                    renderTasks();
                    showStatus('AI bulk completion finished!', 'success');
                }, 2000);

            } catch (error) {
                console.error('Failed to complete bulk AI operation:', error);
                showStatus(`Failed to complete bulk AI operation: ${error.message}`, 'error');
            }
        }

        // Render the task list
        function renderTasks() {
            const taskList = document.getElementById('task-list');
            
            if (tasks.length === 0) {
                taskList.innerHTML = '<p style="text-align: center; color: #666; padding: 20px;">No tasks yet. Add your first task above!</p>';
                return;
            }

            taskList.innerHTML = tasks.map(task => `
                <div class="task-item ${task.completed ? 'completed' : ''}">
                    <div>
                        <strong>${task.text}</strong>
                        <br>
                        <small style="color: #666;">Created: ${task.createdAt}</small>
                    </div>
                    <div class="task-actions">
                        ${!task.completed ? `<button class="btn btn-success" onclick="completeTask(${task.id})">‚úì</button>` : ''}
                        <button class="btn btn-danger" onclick="deleteTask(${task.id})">üóëÔ∏è</button>
                    </div>
                </div>
            `).join('');
        }

        // Update credit display
        async function updateCreditDisplay() {
            try {
                if (sdk) {
                    const credits = await sdk.getCredits();
                    document.getElementById('credit-balance').textContent = credits.toFixed(1);
                }
            } catch (error) {
                console.error('Failed to update credit display:', error);
            }
        }

        // SDK Testing Functions
        async function refreshUserData() {
            showStatus('Refreshing user data...', 'loading');
            await loadUserData();
            showStatus('User data refreshed!', 'success');
        }

        async function testCreditCheck() {
            try {
                if (sdk) {
                    const hasCredits = await sdk.hasCredits(1.0);
                    showStatus(`Credit check: ${hasCredits ? 'You have enough credits (‚â•1.0)' : 'Insufficient credits (<1.0)'}`, 'info');
                } else {
                    showStatus('SDK not initialized for credit check', 'error');
                }
            } catch (error) {
                showStatus(`Credit check failed: ${error.message}`, 'error');
            }
        }

        function simulateError() {
            showStatus('This is a simulated error for testing purposes', 'error');
        }

        // Utility Functions
        function showStatus(message, type) {
            const container = document.getElementById('status-container');
            const statusDiv = document.createElement('div');
            statusDiv.className = `status ${type}`;
            statusDiv.textContent = message;
            
            container.innerHTML = '';
            container.appendChild(statusDiv);
            
            if (type !== 'loading') {
                setTimeout(() => {
                    statusDiv.style.opacity = '0';
                    statusDiv.style.transition = 'opacity 0.5s';
                    setTimeout(() => statusDiv.remove(), 500);
                }, 5000);
            }
        }

        function getApiKeyFromUrl() {
            const params = new URLSearchParams(window.location.search);
            return params.get('api_key');
        }

        function getApiSecretFromUrl() {
            const params = new URLSearchParams(window.location.search);
            return params.get('api_secret');
        }

        function showDemoMode() {
            showStatus('Running in demo mode - some features may be limited', 'info');
            document.getElementById('user-section').classList.remove('hidden');
            document.getElementById('task-section').classList.remove('hidden');
            document.getElementById('sdk-actions').classList.remove('hidden');
            
            // Set demo data
            document.getElementById('user-name').textContent = 'Demo User';
            document.getElementById('user-email').textContent = 'demo@example.com';
            document.getElementById('user-tier').textContent = 'Free';
            document.getElementById('credit-balance').textContent = '10.0';
        }

        // Handle Enter key in task input
        document.addEventListener('DOMContentLoaded', function() {
            document.getElementById('task-input').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    addTask();
                }
            });
        });

        // Initialize the app when the page loads
        window.addEventListener('load', initializeApp);
    </script>
</body>
</html>